<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="mb-1"><i class="bi bi-house-gear-fill"></i> Configurações da Home</h1>
      <p class="text-muted mb-0">Personalize a aparência e conteúdo da página inicial</p>
    </div>
    <%= link_to 'Voltar', admin_root_path, class: 'btn btn-outline-secondary' %>
  </div>

  <%= form_with(model: @home_setting, url: admin_home_setting_path, local: true) do |f| %>
    <% if @home_setting.errors.any? %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <h5 class="alert-heading"><i class="bi bi-exclamation-triangle-fill me-2"></i><%= pluralize(@home_setting.errors.count, "erro") %> encontrado:</h5>
        <ul class="mb-0">
          <% @home_setting.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% end %>

    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs mb-4" id="homeSettingsTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="hero-tab" data-bs-toggle="tab" data-bs-target="#hero" type="button" role="tab">
          <i class="bi bi-image me-2"></i>Seção Hero
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="cta-tab" data-bs-toggle="tab" data-bs-target="#cta" type="button" role="tab">
          <i class="bi bi-megaphone me-2"></i>Call to Action
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="sections-tab" data-bs-toggle="tab" data-bs-target="#sections" type="button" role="tab">
          <i class="bi bi-layout-three-columns me-2"></i>Gerenciar Seções
        </button>
      </li>
    </ul>

    <!-- Tabs Content -->
    <div class="tab-content" id="homeSettingsTabsContent">
      
      <!-- Hero Tab -->
      <div class="tab-pane fade show active" id="hero" role="tabpanel">
        <div class="row g-4">
          <!-- Text Content -->
          <div class="col-12">
            <div class="card shadow-sm border-0">
              <div class="card-header bg-primary bg-opacity-10 border-0">
                <h5 class="mb-0 text-primary"><i class="bi bi-text-left me-2"></i>Conteúdo do Hero</h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <%= f.label :hero_title, "Título Principal", class: "form-label fw-bold" %>
                  <%= f.text_area :hero_title, rows: 2, class: "form-control", placeholder: "Compre ou alugue na imobiliária mais amada de Balneário Camboriú" %>
                  <small class="text-muted">Texto principal que aparece no topo da home</small>
                </div>

                <div class="mb-0">
                  <%= f.label :hero_subtitle, "Subtítulo", class: "form-label fw-bold" %>
                  <%= f.text_area :hero_subtitle, rows: 2, class: "form-control", placeholder: "Aqui o lar é o centro das grandes histórias da vida." %>
                  <small class="text-muted">Texto secundário abaixo do título</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Background Images -->
          <div class="col-md-6">
            <div class="card shadow-sm border-0 h-100">
              <div class="card-header bg-success bg-opacity-10 border-0">
                <h5 class="mb-0 text-success"><i class="bi bi-laptop me-2"></i>Imagem Desktop</h5>
              </div>
              <div class="card-body">
                <%= f.label :hero_background_desktop, "Imagem de Fundo (Desktop)", class: "form-label fw-bold" %>
                <%= f.file_field :hero_background_desktop, class: "form-control mb-3", accept: "image/*" %>
                <small class="text-muted d-block mb-3">Recomendado: 1920x1080px</small>
                
                <% if @home_setting.hero_background_desktop.attached? %>
                  <div class="position-relative overflow-hidden rounded shadow-sm">
                    <%= image_tag @home_setting.hero_background_desktop, class: "img-fluid w-100", id: "hero-desktop-image" %>
                    <div id="hero-overlay-preview" 
                         style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
                                background-color: <%= @home_setting.overlay_color || '#000000' %>; 
                                opacity: <%= @home_setting.overlay_opacity || 0.7 %>; 
                                pointer-events: none; transition: all 0.2s ease;">
                    </div>
                    <span class="badge bg-success position-absolute top-0 start-0 m-2" style="z-index: 5;">
                      <i class="bi bi-check-circle me-1"></i>Imagem Atual
                    </span>
                  </div>
                <% else %>
                  <div class="text-center p-4 bg-light rounded">
                    <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                    <p class="text-muted mt-2 mb-0">Nenhuma imagem carregada</p>
                  </div>
                <% end %>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card shadow-sm border-0 h-100">
              <div class="card-header bg-info bg-opacity-10 border-0">
                <h5 class="mb-0 text-info"><i class="bi bi-phone me-2"></i>Imagem Mobile</h5>
              </div>
              <div class="card-body">
                <%= f.label :hero_background_mobile, "Imagem de Fundo (Mobile)", class: "form-label fw-bold" %>
                <%= f.file_field :hero_background_mobile, class: "form-control mb-3", accept: "image/*" %>
                <small class="text-muted d-block mb-3">Recomendado: 768x1024px (vertical)</small>
                
                <% if @home_setting.hero_background_mobile.attached? %>
                  <div class="position-relative">
                    <%= image_tag @home_setting.hero_background_mobile, class: "img-fluid rounded shadow-sm" %>
                    <span class="badge bg-info position-absolute top-0 start-0 m-2">
                      <i class="bi bi-check-circle me-1"></i>Imagem Atual
                    </span>
                  </div>
                <% else %>
                  <div class="text-center p-4 bg-light rounded">
                    <i class="bi bi-phone text-muted" style="font-size: 3rem;"></i>
                    <p class="text-muted mt-2 mb-0">Nenhuma imagem carregada</p>
                  </div>
                <% end %>
              </div>
            </div>
          </div>

          <!-- CTA Button & Overlay -->
          <div class="col-12">
            <div class="card shadow-sm border-0">
              <div class="card-header bg-warning bg-opacity-10 border-0">
                <h5 class="mb-0 text-warning"><i class="bi bi-sliders me-2"></i>Personalização Visual</h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <!-- Overlay Settings Block -->
                  <div class="col-12 mb-4">
                    <h6 class="text-uppercase text-muted fw-bold small mb-3 border-bottom pb-2">Configurações de Sobreposição (Overlay)</h6>
                    <div class="row">
                      <div class="col-md-4 mb-3">
                        <%= f.label :overlay_opacity, class: "form-label fw-bold" do %>
                          Opacidade <span class="badge bg-secondary">0.0 - 1.0</span>
                        <% end %>
                        <div class="input-group">
                          <%= f.number_field :overlay_opacity, step: 0.1, min: 0, max: 1, class: "form-control", placeholder: "0.7", id: "input-overlay-opacity", oninput: "updateOverlayPreview()" %>
                          <span class="input-group-text"><i class="bi bi-opacity"></i></span>
                        </div>
                      </div>

                      <div class="col-md-5 mb-3">
                        <%= f.label :overlay_color, "Cor da Sobreposição", class: "form-label fw-bold" %>
                        <div class="d-flex gap-2 align-items-center">
                          <%= f.color_field :overlay_color, value: @home_setting.overlay_color || '#000000', class: "form-control form-control-color", id: "input-overlay-color-picker", style: "width: 80px; height: 48px;", oninput: "syncOverlayColor(this, 'picker')" %>
                          <%= f.text_field :overlay_color, value: @home_setting.overlay_color || '#000000', class: "form-control", id: "input-overlay-color-text", oninput: "syncOverlayColor(this, 'text')" %>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Search Button Block -->
                  <div class="col-12">
                    <h6 class="text-uppercase text-muted fw-bold small mb-3 border-bottom pb-2">Personalização do Botão de Busca</h6>
                    <div class="row">
                      <div class="col-md-4 mb-3">
                        <%= f.label :hero_cta_text, "Texto do Botão de Busca", class: "form-label fw-bold" %>
                        <%= f.text_field :hero_cta_text, class: "form-control", placeholder: "Buscar Imóveis" %>
                      </div>

                      <div class="col-md-4 mb-3">
                        <%= f.label :hero_button_color, "Cor do Botão de Busca", class: "form-label fw-bold" %>
                        <div class="d-flex gap-2 align-items-center">
                          <%= f.color_field :hero_button_color, value: @home_setting.hero_button_color || '#BFAB25', class: "form-control form-control-color", style: "width: 80px; height: 48px;", oninput: "this.nextElementSibling.value = this.value" %>
                          <%= f.text_field :hero_button_color, value: @home_setting.hero_button_color || '#BFAB25', class: "form-control", oninput: "this.previousElementSibling.value = this.value" %>
                        </div>
                      </div>

                      <div class="col-md-4 mb-3">
                        <%= f.label :hero_button_text_color, "Cor do Texto do Botão", class: "form-label fw-bold" %>
                        <div class="d-flex gap-2 align-items-center">
                          <%= f.color_field :hero_button_text_color, value: @home_setting.hero_button_text_color || '#FFFFFF', class: "form-control form-control-color", style: "width: 80px; height: 48px;", oninput: "this.nextElementSibling.value = this.value" %>
                          <%= f.text_field :hero_button_text_color, value: @home_setting.hero_button_text_color || '#FFFFFF', class: "form-control", oninput: "this.previousElementSibling.value = this.value" %>
                        </div>
                      </div>

                      <% if false %>
                        <div class="col-md-12">
                          <%= f.label :hero_cta_link, "Link do Botão (Opcional)", class: "form-label fw-bold" %>
                          <%= f.text_field :hero_cta_link, class: "form-control", placeholder: "/imoveis" %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CTA Tab -->
      <div class="tab-pane fade" id="cta" role="tabpanel">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-primary bg-opacity-10 border-0">
            <h5 class="mb-0 text-primary"><i class="bi bi-megaphone-fill me-2"></i>Seção Call to Action</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <%= f.label :cta_title, "Título", class: "form-label fw-bold" %>
                <%= f.text_field :cta_title, class: "form-control", placeholder: "Pronto para Encontrar Seu Imóvel?" %>
                <small class="text-muted">Título da seção de chamada para ação</small>
              </div>

              <div class="col-md-6 mb-3">
                <%= f.label :cta_subtitle, "Subtítulo", class: "form-label fw-bold" %>
                <%= f.text_field :cta_subtitle, class: "form-control", placeholder: "Entre em contato conosco e descubra as melhores oportunidades" %>
                <small class="text-muted">Descrição complementar</small>
              </div>
            </div>

            <div class="alert alert-info mt-3">
              <i class="bi bi-info-circle me-2"></i>
              <strong>Dica:</strong> Esta seção aparece no final da página inicial, incentivando os visitantes a entrarem em contato.
            </div>
          </div>
        </div>
      </div>

      <!-- Sections Tab -->
      <div class="tab-pane fade" id="sections" role="tabpanel">
        <div class="card shadow-sm border-0">
          <div class="card-header bg-success bg-opacity-10 border-0">
            <h5 class="mb-0 text-success"><i class="bi bi-toggles me-2"></i>Controle de Seções da Home</h5>
          </div>
          <div class="card-body">
            <p class="text-muted mb-4">
              <i class="bi bi-info-circle me-2"></i>
              Ative ou desative seções específicas da página inicial. Seções desativadas não aparecerão para os visitantes.
            </p>

            <div class="row g-3">
              <div class="col-md-4">
                <div class="card h-100 shadow-sm">
                  <div class="card-body">
                    <div class="form-check form-switch">
                      <%= f.check_box :services_active, class: "form-check-input", role: "switch", id: "services_active" %>
                      <%= f.label :services_active, class: "form-check-label fw-bold" do %>
                        <i class="bi bi-grid-3x3-gap me-2 text-primary"></i>Nossos Serviços
                      <% end %>
                    </div>
                    <p class="text-muted small mt-2 mb-0">Exibe os serviços oferecidos pela imobiliária</p>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card h-100 shadow-sm">
                  <div class="card-body">
                    <div class="form-check form-switch">
                      <%= f.check_box :why_choose_active, class: "form-check-input", role: "switch", id: "why_choose_active" %>
                      <%= f.label :why_choose_active, class: "form-check-label fw-bold" do %>
                        <i class="bi bi-star me-2 text-warning"></i>Por Que Escolher
                      <% end %>
                    </div>
                    <p class="text-muted small mt-2 mb-0">Mostra os diferenciais da empresa</p>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card h-100 shadow-sm">
                  <div class="card-body">
                    <div class="form-check form-switch">
                      <%= f.check_box :cta_contact_active, class: "form-check-input", role: "switch", id: "cta_contact_active" %>
                      <%= f.label :cta_contact_active, class: "form-check-label fw-bold" do %>
                        <i class="bi bi-telephone me-2 text-success"></i>CTA de Contato
                      <% end %>
                    </div>
                    <p class="text-muted small mt-2 mb-0">Seção de chamada para entrar em contato</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="alert alert-warning mt-4">
              <i class="bi bi-exclamation-triangle me-2"></i>
              <strong>Atenção:</strong> As seções de imóveis (Destaques, Oportunidades, etc.) são gerenciadas em 
              <%= link_to 'Seções Homepage', admin_home_sections_path, class: 'alert-link' %>.
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Save Button -->
    <div class="d-flex justify-content-between align-items-center mt-4 p-4 bg-light rounded">
      <div>
        <i class="bi bi-info-circle text-primary me-2"></i>
        <span class="text-muted">Não esqueça de salvar suas alterações</span>
      </div>
      <%= f.submit "Salvar Configurações", class: "btn btn-primary btn-lg px-5", data: { disable_with: "Salvando..." } %>
    </div>
  <% end %>
</div>

<script>
  function updateOverlayPreview() {
    const color = document.getElementById('input-overlay-color-text').value;
    const opacity = document.getElementById('input-overlay-opacity').value;
    const preview = document.getElementById('hero-overlay-preview');
    
    if (preview) {
      preview.style.backgroundColor = color;
      preview.style.opacity = opacity;
    }
  }

  function syncOverlayColor(input, type) {
    const picker = document.getElementById('input-overlay-color-picker');
    const text = document.getElementById('input-overlay-color-text');
    
    if (type === 'picker') {
      text.value = input.value;
    } else {
      // Validate hex color before syncing to picker
      if (/^#[0-9A-F]{6}$/i.test(input.value)) {
        picker.value = input.value;
      }
    }
    updateOverlayPreview();
  }
</script>
