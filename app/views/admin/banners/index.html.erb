<div class="admin-header shadow-sm">
  <div class="admin-header-title">
    <h1>Banners Institucionais</h1>
    <p>Gerencie os banners rotativos e de destaque das páginas</p>
  </div>
  <div class="admin-header-actions">
    <%= link_to new_admin_banner_path, class: "btn btn-primary d-flex align-items-center gap-2 px-4 py-2 shadow-sm rounded-3" do %>
      <i class="bi bi-plus-lg fs-5"></i>
      <span class="fw-bold">Novo Banner</span>
    <% end %>
  </div>
</div>

<% if flash[:notice] %>
  <div class="alert alert-success alert-dismissible fade show border-0 shadow-sm mb-4" role="alert">
    <div class="d-flex align-items-center gap-2">
      <i class="bi bi-check-circle-fill fs-5"></i>
      <div><%= flash[:notice] %></div>
    </div>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
<% end %>

<div class="card card-luxury">
  <div class="card-header py-3 px-4">
    <div class="d-flex align-items-center gap-2">
      <i class="bi bi-collection-play-fill text-primary"></i>
      <h5 class="mb-0">Lista de Banners Ativos</h5>
    </div>
    <div class="text-muted small">
      Total: <%= @banners.count %> banners
    </div>
  </div>
  
  <div class="table-responsive">
    <table class="table-premium">
      <thead>
        <tr>
          <th width="120">Preview</th>
          <th>Informações do Banner</th>
          <th width="200">Localização</th>
          <th width="100" class="text-center">Ordem</th>
          <th width="150" class="text-center">Status</th>
          <th width="300" class="text-end">Ações Rápidas</th>
        </tr>
      </thead>
      <tbody>
        <% if @banners.any? %>
          <% @banners.each do |banner| %>
            <tr>
              <td>
                <div class="preview-image-wrapper shadow-sm border" style="width: 100px; height: 56px;">
                  <% if banner.image_desktop.attached? %>
                    <img src="<%= url_for(banner.image_desktop) %>" style="width: 100%; height: 100%; object-fit: cover;">
                  <% else %>
                    <div class="bg-light w-100 h-100 d-flex align-items-center justify-content-center text-muted">
                      <i class="bi bi-image small"></i>
                    </div>
                  <% end %>
                </div>
              </td>
              <td>
                <div class="fw-bold text-dark mb-1"><%= banner.title %></div>
                <% if banner.description.present? %>
                  <div class="text-muted small lh-sm"><%= truncate(banner.description, length: 70) %></div>
                <% end %>
              </td>
              <td>
                <% if banner.positions.present? %>
                  <div class="d-flex flex-wrap gap-1">
                    <% banner.positions.each do |pos| %>
                      <span class="badge badge-pill badge-soft-info border border-primary border-opacity-10">
                        <%= Banner::POSITIONS[pos] || pos.humanize %>
                      </span>
                    <% end %>
                  </div>
                <% else %>
                  <span class="badge badge-pill badge-soft-secondary">Não definido</span>
                <% end %>
              </td>
              <td class="text-center">
                <span class="fw-bold text-muted">#<%= banner.display_order %></span>
              </td>
              <td class="text-center">
                <% if banner.active? %>
                  <span class="badge badge-pill badge-soft-success">
                    <i class="bi bi-circle-fill me-1 small"></i> Ativo
                  </span>
                <% else %>
                  <span class="badge badge-pill badge-soft-secondary text-muted">
                    <i class="bi bi-circle me-1 small"></i> Inativo
                  </span>
                <% end %>
              </td>
              <td class="text-end">
                <div class="btn-action-group">
                  <%= link_to admin_banner_path(banner), class: "btn-action btn-action-view", title: "Ver Detalhes" do %>
                    <i class="bi bi-eye"></i> Visualizar
                  <% end %>
                  <%= link_to edit_admin_banner_path(banner), class: "btn-action btn-action-edit", title: "Editar" do %>
                    <i class="bi bi-pencil-square"></i> Editar
                  <% end %>
                  <%= link_to admin_banner_path(banner), 
                      data: { turbo_method: :delete, turbo_confirm: "Confirmar exclusão deste banner?" }, 
                      class: "btn-action btn-action-delete", title: "Remover" do %>
                    <i class="bi bi-trash"></i>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="6" class="text-center py-5">
              <div class="py-4">
                <i class="bi bi-image-fill display-4 text-light mb-3 d-block"></i>
                <h5 class="text-muted fw-bold">Nenhum banner encontrado</h5>
                <p class="text-muted small">Crie seu primeiro banner clicando no botão acima.</p>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<% if @banners.total_pages > 1 %>
  <div class="d-flex justify-content-center mt-5 mb-5">
    <%= will_paginate @banners, class: 'pagination' %>
  </div>
<% end %>
